<!DOCTYPE html>
<html lang="en" class="h-full antialiased [scrollbar-gutter:stable]">

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="theme-color" content="#0a0a0a"/>
    <title>Angkorkey — Clean Shop</title>

    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"/>

    <style>
        :root {
            --ink: #0a0a0a;
            --muted: #6b7280;
            --ring: #111827;
            --card: #ffffff;
            --border: #e5e7eb;
            --accent: #ef4444;
        }

        * { box-sizing: border-box }
        html, body { height: 100% }

        body {
            font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Inter, Arial, sans-serif;
            background: #fff;
            color: var(--ink)
        }

        /* Utilities */
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none }
        .scrollbar-hide::-webkit-scrollbar { display: none }

        .chip {
            background: #f9fafb;
            border: 1px solid var(--border);
            color: #374151;
            transition: all .2s ease
        }
        .chip[data-active="true"] {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent)
        }
        .chip:active { transform: scale(.98) }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            transition: transform .25s ease, border-color .25s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            border-color: var(--accent);
        }

        /* Animations */
        @keyframes cardIn {
            0% { opacity: 0; transform: translateY(8px) scale(.98) }
            100% { opacity: 1; transform: translateY(0) scale(1) }
        }
        .card-enter {
            opacity: 0;
            animation: cardIn .38s cubic-bezier(.22, .61, .36, 1) forwards;
            will-change: transform, opacity
        }
        @media (prefers-reduced-motion: reduce) {
            .card, .chip { transition: none }
            .card-enter { animation: none; opacity: 1 }
        }

        .backdrop { backdrop-filter: blur(6px) }

        /* Custom Prose Overrides */
        .prose p { margin-bottom: 0.5em; }
        .prose ul { list-style-type: disc; padding-left: 1.2em; margin-bottom: 0.5em; }
        .prose strong { color: var(--ink); font-weight: 600; }
    </style>
</head>

<body class="min-h-full">
<header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-gray-100">
    <div class="max-w-6xl mx-auto px-5 py-4 flex items-center gap-3">
        <div class="size-8 rounded-lg bg-black text-white grid place-items-center font-semibold">A</div>
        <h1 class="text-xl md:text-2xl font-semibold tracking-tight">Angkorkey</h1>
        <div class="ml-auto hidden md:flex items-center gap-3">
            <a class="text-sm text-gray-600 hover:text-[color:var(--accent)]" href="#">About</a>
            <a class="text-sm text-gray-600 hover:text-[color:var(--accent)]" href="#">Contact</a>
        </div>
    </div>
</header>

<section class="max-w-6xl mx-auto px-5 pt-4 pb-2">
    <div class="relative">
        <i class="bi bi-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
        <input id="searchInput" type="text" inputmode="search" placeholder="Search products…"
               class="w-full pl-10 pr-3 py-3 rounded-xl bg-gray-50 border border-gray-200 text-sm focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] focus:border-[color:var(--accent)]"
               aria-label="Search products"/>
    </div>
</section>

<section class="max-w-6xl mx-auto px-5 pb-4">
    <div class="flex gap-2 overflow-x-auto scrollbar-hide pb-2 snap-x">
        <button class="chip px-4 py-1.5 rounded-lg text-sm snap-start" data-category="all" data-active="true">All</button>
        <button class="chip px-4 py-1.5 rounded-lg text-sm snap-start" data-category="iem">Headphone</button>
        <button class="chip px-4 py-1.5 rounded-lg text-sm snap-start" data-category="accessories">Accessories</button>
    </div>
</section>

<main class="max-w-6xl mx-auto px-5 pb-16">
    <div id="productsGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-5"></div>
</main>

<div id="productModal" class="fixed inset-0 z-50 hidden items-center justify-center p-4 backdrop bg-black/60"></div>

<script>
    /* ----------------------- Data ----------------------- */
    const PRODUCTS = [
        {
            id: '2',
            name: 'Moondrop Chu II',
            price: 22,
            category: 'iem',
            description: '<p><strong>High-Fidelity Sound</strong> in a durable metal build. This is the ultimate value proposition for the discerning listener.</p><ul><li><strong>10mm Dynamic Driver</strong> with VDSF tuning</li><li>Wide soundstage & detailed resolution</li><li>Detachable 0.78mm 2-pin cable (3.5mm plug)</li></ul><p>Premium zinc alloy construction with a CNC-machined brass nozzle for under $25.</p>',
            images: ['assets/images/Main-03.jpg', 'assets/images/Main-02.jpg', 'assets/images/Main-01.jpg', 'assets/images/Main-04.jpg']
        },
        {
            id: '3',
            name: 'QKZ AK3',
            price: 8,
            category: 'iem',
            description: '<p><strong>Dazzling Clear Design & Studio-Grade Sound</strong>.</p><ul><li><strong>Transparent Resin Shell</strong></li><li><strong>Hi-Fi Acoustic Tuning</strong></li><li>28° angled nozzle</li><li><strong>3.5mm cable with Mic</strong></li></ul>',
            images: ['assets/images/QkzAK3__0005.webp', 'assets/images/QkzAK3__0006.webp', 'assets/images/QkzAK3__0007webp', 'assets/images/QkzAK3__0008.webp']
        },
        {
            id: '4',
            name: 'QKZ X HBB',
            price: 22,
            category: 'iem',
            description: '<p><strong>Bass-Tuned Collaboration</strong>. Designed with Hawaii Bad Boy (HBB) for rich, impactful low-end without muddying the mids.</p><ul><li><strong>Optimized Magnetic Circuit</strong></li><li>Custom tuned for Rock, Hip-Hop, and Pop</li><li>Detachable 2-pin cable</li></ul>',
            images: ['assets/images/QkzXHBB__0001.webp', 'assets/images/QkzXHBB__0002.webp', 'assets/images/QkzXHBB__0003.webp', 'assets/images/QkzXHBB__0004.webp']
        },
        {
            id: '5',
            name: 'KZ Castor Pro',
            price: 22,
            category: 'iem',
            description: '<p><strong>Dual Dynamic Driver Power & Customizable Sound</strong>.</p><ul><li><strong>Dual Drivers</strong> (10mm + 6mm)</li><li><strong>4-Way Tuning Switches</strong></li><li>Ergonomic resin shell</li></ul>',
            images: ['assets/images/KZCastorPro__0001.webp', 'assets/images/KZCastorPro__0002.webp', 'assets/images/KZCastorPro__0003.webp', 'assets/images/KZCastorPro__0004.webp']
        },
        {
            id: '6',
            name: 'Tanchjim Bunny Type C',
            price: 25,
            category: 'iem',
            description: '<p><strong>All-in-One Hi-Fi Audio Experience</strong> with built-in DSP.</p><ul><li><strong>Built-in DAC & Amp</strong></li><li><strong>Dual Dynamic Driver</strong></li><li>Plug-and-Play USB-C</li></ul>',
            images: ['assets/images/TBunny__0003.webp', 'assets/images/TBunny__0002.webp', 'assets/images/TBunny__0001.webp', 'assets/images/TBunny__0004.webp']
        },
        {
            id: '7',
            name: 'Tanchjim Bunny 3.5mm',
            price: 25,
            category: 'iem',
            description: '<p><strong>Pure Analog Audio Performance</strong>.</p><ul><li><strong>Dual Dynamic Driver System</strong></li><li><strong>Universal 3.5mm Connection</strong></li><li>Lightweight ergonomic shell</li></ul>',
            images: ['assets/images/TBunny__0003.webp', 'assets/images/TBunny_3.5_0001.webp', 'assets/images/TBunny_3.5_0002.webp', 'assets/images/TBunny__0004.webp']
        },
        {
            id: '8',
            name: 'Tangzu Waner SG 2 Green',
            price: 38,
            category: 'iem',
            description: '<p><strong>Space Jam Edition</strong>. High-performance, neutrally-tuned audio.</p><ul><li><strong>Neutral-Balanced Tuning</strong></li><li><strong>Dual Magnetic Circuit Driver</strong></li><li>Collectible design</li></ul>',
            images: ['assets/images/TWanerSG2B_0002.webp', 'assets/images/TWanerSG2B_0001.webp', 'assets/images/TWanerSG2B_0003.webp', 'assets/images/TWanerSG2B_0004.webp']
        },
        {
            id: '9',
            name: 'Tangzu Waner SG 2 Black',
            price: 38,
            category: 'iem',
            description: '<p><strong>Space Jam Edition</strong> in Black.</p><ul><li><strong>Neutral-Balanced Tuning</strong></li><li><strong>Dual Magnetic Circuit Driver</strong></li><li>Collectible design</li></ul>',
            images: ['assets/images/TWanerSG2B_0003-1.webp', 'assets/images/TWanerSG2B_0001-1.webp', 'assets/images/TWanerSG2B_0003-1.webp', 'assets/images/TWanerSG2B_0004-1.webp']
        },
        {
            id: '10',
            name: 'Monitor Stand',
            price: 15,
            category: 'accessories',
            description: '<p><strong>Expanded Workspace with Integrated Hub</strong>.</p><ul><li><strong>Spacious Platform:</strong> 55cm x 20cm</li><li><strong>Integrated 4-Port USB Hub</strong></li><li><strong>7.5cm Ergonomic Height</strong></li></ul>',
            images: ['assets/images/MonitorStand_0001.webp', 'assets/images/MonitorStand_0002.webp', 'assets/images/MonitorStand_0003.webp', 'assets/images/MonitorStand_0004.webp']
        },
    ];

    /* ----------------------- Utilities ----------------------- */
    const $ = (sel, ctx = document) => ctx.querySelector(sel);
    const $$ = (sel, ctx = document) => Array.from(ctx.querySelectorAll(sel));
    const fmtPrice = v => new Intl.NumberFormat(undefined, {style: 'currency', currency: 'USD'}).format(v);

    /* ----------------------- Render Products ----------------------- */
    let currentFilter = 'all';
    const grid = $('#productsGrid');

    function cardTemplate(product, i) {
        return `
        <article class="card rounded-2xl p-2 card-enter" style="animation-delay:${i * 60}ms" role="button" tabindex="0" aria-label="View ${product.name}" data-id="${product.id}">
          <div class="relative group">
            <div class="aspect-square bg-gray-100 overflow-hidden rounded-xl">
              <img loading="lazy" src="${product.images[0]}" onerror="this.src='https://placehold.co/400?text=No+Image'" alt="${product.name}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"/>
            </div>
            <div class="absolute left-3 top-3 inline-flex items-center gap-1.5 bg-white/90 backdrop-blur px-2.5 py-1 rounded-full text-[11px]">
              <span class="size-1.5 rounded-full bg-emerald-500"></span> In stock
            </div>
          </div>
          <div class="p-2 pt-3">
            <h3 class="text-sm font-medium truncate">${product.name}</h3>
            <div class="mt-1 flex items-center justify-between">
              <p class="text-base font-semibold text-[color:var(--accent)]">${fmtPrice(product.price)}</p>
              <button class="text-gray-400 hover:text-[color:var(--accent)]" aria-label="Quick view"><i class="bi bi-eye"></i></button>
            </div>
          </div>
        </article>`;
    }

    function render(list) {
        grid.innerHTML = list.map((p, i) => cardTemplate(p, i)).join('');
        $$('#productsGrid article').forEach(card => {
            card.addEventListener('click', () => openModal(card.dataset.id));
            card.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    openModal(card.dataset.id);
                }
            });
        });
        observeStagger();
    }

    function applyFilter() {
        const dataset = currentFilter === 'all' ? PRODUCTS : PRODUCTS.filter(p => p.category === currentFilter);
        render(dataset);
    }

    /* ----------------------- Search ----------------------- */
    const searchEl = $('#searchInput');
    let searchTimer;
    searchEl.addEventListener('input', (e) => {
        clearTimeout(searchTimer);
        const q = e.target.value.trim().toLowerCase();
        searchTimer = setTimeout(() => {
            const base = currentFilter === 'all' ? PRODUCTS : PRODUCTS.filter(p => p.category === currentFilter);
            const filtered = q ? base.filter(p => (p.name + " " + p.description).toLowerCase().includes(q)) : base;
            render(filtered);
        }, 120);
    });

    $$('.chip').forEach(ch => {
        ch.addEventListener('click', () => {
            $$('.chip').forEach(c => c.dataset.active = 'false');
            ch.dataset.active = 'true';
            currentFilter = ch.dataset.category;
            applyFilter();
        });
    });

    /* ----------------------- Fixed Modal Logic ----------------------- */
    const modal = $('#productModal');
    let lastFocus = null;

    // UPDATED: Fixed layout template that doesn't scroll the page
    function modalTemplate(p) {
        return `
        <div class="bg-white max-w-4xl w-full rounded-2xl shadow-2xl mx-4 flex flex-col md:flex-row h-[85vh] overflow-hidden relative" role="dialog" aria-modal="true" aria-label="${p.name}">

          <div class="w-full h-[45%] md:w-1/2 md:h-full bg-gray-50 flex flex-col relative group border-b md:border-b-0 md:border-r border-gray-100">

            <div class="flex-1 relative min-h-0 p-6 flex items-center justify-center">
               <img id="mainImg" src="${p.images[0]}" onerror="this.src='https://placehold.co/400?text=No+Image'" alt="${p.name}" class="max-w-full max-h-full object-contain drop-shadow-sm mix-blend-multiply transition-opacity duration-300"/>
            </div>

            <div class="h-16 shrink-0 bg-white flex items-center px-4 gap-2 overflow-x-auto scrollbar-hide border-t border-gray-100 z-10">
               ${p.images.map((src, idx) => `
                <button class="shrink-0 size-10 rounded-lg border border-gray-200 overflow-hidden hover:opacity-80 transition-all ${idx === 0 ? 'ring-2 ring-[color:var(--accent)]' : ''}" data-thumb>
                    <img src="${src}" class="w-full h-full object-cover" />
                </button>`).join('')}
            </div>
          </div>

          <div class="w-full h-[55%] md:w-1/2 md:h-full flex flex-col bg-white relative">

            <div class="p-5 pb-2 shrink-0">
                 <div class="flex justify-between items-start">
                    <h2 class="text-xl md:text-2xl font-bold text-gray-900 leading-tight pr-10 line-clamp-2">${p.name}</h2>
                    <button id="closeBtn" class="absolute top-4 right-4 bg-gray-100 hover:bg-[color:var(--accent)] hover:text-white transition-colors size-8 rounded-full grid place-items-center shrink-0 z-20" aria-label="Close">
                      <i class="bi bi-x-lg text-sm"></i>
                    </button>
                 </div>
                 <p class="text-lg md:text-xl font-semibold text-[color:var(--accent)] mt-1">${fmtPrice(p.price)}</p>
            </div>

            <div class="px-5 py-2 overflow-y-auto flex-1">
                <div class="prose prose-sm text-gray-500 leading-relaxed">
                    ${p.description}
                </div>
            </div>

            <div class="p-5 pt-3 mt-auto shrink-0 border-t border-gray-50 bg-white/50 backdrop-blur-sm">
              <a id="tgLink" href="#" target="_blank" class="w-full bg-black hover:bg-[color:var(--accent)] transition-colors text-white py-3 rounded-xl text-center text-sm font-bold tracking-wide inline-flex items-center justify-center gap-2 shadow-lg shadow-gray-200">
                <i class="bi bi-telegram"></i><span>Order Now</span>
              </a>
            </div>
          </div>
        </div>`;
    }

    function openModal(id) {
        const p = PRODUCTS.find(x => x.id === id);
        if (!p) return;
        lastFocus = document.activeElement;

        // Show modal container
        modal.classList.remove('hidden');
        modal.classList.add('flex');

        // Render content
        modal.innerHTML = modalTemplate(p);

        // Lock body scroll
        document.body.style.overflow = 'hidden';

        // Setup Image Logic
        const main = $('#mainImg', modal);
        const thumbs = $$('[data-thumb]', modal);

        thumbs.forEach((thumb, idx) => {
            thumb.addEventListener('click', () => {
                // Fade out, change src, fade in
                main.style.opacity = '0.5';
                setTimeout(() => {
                    main.src = p.images[idx];
                    main.style.opacity = '1';
                }, 100);

                // Update active state styling
                thumbs.forEach(t => t.classList.remove('ring-2', 'ring-[color:var(--accent)]'));
                thumb.classList.add('ring-2', 'ring-[color:var(--accent)]');
            });
        });

        // Setup Link
        $('#tgLink', modal).href = `https://t.me/angkorkey_admin_2?text=${encodeURIComponent('Hello, I\'m interested in ' + p.name)}`;

        // Setup Close Logic
        const close = () => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            modal.innerHTML = ''; // Clean up to stop videos/etc if you had them
            document.body.style.overflow = '';
            if (lastFocus) lastFocus.focus();
        }

        $('#closeBtn', modal).addEventListener('click', close);

        // Click outside to close
        modal.addEventListener('click', (e) => {
            if (e.target === modal) close();
        });

        // Esc key to close
        const escClose = (e) => {
            if (e.key === 'Escape') {
                close();
                document.removeEventListener('keydown', escClose);
            }
        };
        document.addEventListener('keydown', escClose);

        // Focus management
        $('#closeBtn', modal).focus();
    }

    /* ----------------------- Stagger on view ----------------------- */
    function observeStagger() {
        const cards = $$('#productsGrid .card-enter');
        const io = new IntersectionObserver((entries) => {
            entries.forEach(e => {
                if (e.isIntersecting) {
                    e.target.style.visibility = 'visible';
                    io.unobserve(e.target);
                }
            });
        }, {threshold: .06});
        cards.forEach(c => {
            c.style.visibility = 'hidden';
            io.observe(c);
        });
    }

    // Initial paint
    applyFilter();
</script>
</body>
</html>